<!-- <!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Potree Viewer</title>

	<link rel="stylesheet" type="text/css" href="../build/potree/potree.css">
	<link rel="stylesheet" type="text/css" href="../libs/jquery-ui/jquery-ui.min.css">
	<link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css">
	<link rel="stylesheet" type="text/css" href="../libs/spectrum/spectrum.css">
	<link rel="stylesheet" type="text/css" href="../libs/jstree/themes/mixed/style.css">
</head>

<body>
	<script src="../libs/jquery/jquery-3.1.1.min.js"></script>
	<script src="../libs/spectrum/spectrum.js"></script>
	<script src="../libs/jquery-ui/jquery-ui.min.js"></script>
	<script src="../libs/other/BinaryHeap.js"></script>
	<script src="../libs/tween/tween.min.js"></script>
	<script src="../libs/d3/d3.js"></script>
	<script src="../libs/proj4/proj4.js"></script>
	<script src="../libs/openlayers3/ol.js"></script>
	<script src="../libs/i18next/i18next.js"></script>
	<script src="../libs/jstree/jstree.js"></script>
	<script src="../build/potree/potree.js"></script>
	<script src="../libs/plasio/js/laslaz.js"></script>

	<div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px;">
		<div id="potree_render_area" style="background-image: url('../build/potree/resources/images/background.jpg');"></div>
		<div id="potree_sidebar_container"></div>
	</div>

	<button id="backButton" onclick="window.history.back();" style="
    position: absolute;
    top: 20px;
    right: 20px;
    padding: 10px 20px;
    background-color: #f44336;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 16px;
    z-index: 1000; /* Ensure it is above other elements */
    transition: background-color 0.3s;
	" onmouseover="this.style.backgroundColor='#e53935';" onmouseout="this.style.backgroundColor='#f44336';">
		Back
	</button>



	<script type="module">

		import * as THREE from "../libs/three.js/build/three.module.js";

		window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));

		// viewer.setDescription("Potree projects that were exported (Scene → Export → Potree) can be loaded with viewer.loadProject(url). ");

		viewer.loadGUI().then(() => {
			viewer.setLanguage('en');
			$("#menu_tools").next().show();
			viewer.toggleSidebar();
		});

		// Function to extract query parameter from URL
		function getUrlParameter(name) {
			name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
			var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
			var results = regex.exec(location.search);
			return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
		}

		// Fetch the filename from URL query parameter
		const lasFilename = getUrlParameter('lasFilename');

		if (lasFilename) {
			// Construct the URL for potree.json based on filename
			const projectURL = `../pointclouds/${lasFilename}/potree.json`;

			// Load the Potree project
			viewer.loadProject(projectURL).then(() => {
				console.log(`Project ${projectURL} loaded`);
			}).catch(error => {
				console.error('Error loading project:', error);
			});
		} else {
			console.error('No lasFilename parameter found in the URL');
		}

		function createAnnotationWithHyperlink() {
			const annotation = new Potree.Annotation({
				position: new THREE.Vector3(6.151, -0.530, 1.016),
				title: "Annotation Title",
				description: '<a href="http://localhost:1234/examples/load_project.html?lasFilename=UNB Harrison House Renovation 1" target="_blank">Open Project</a>'
			});

        viewer.scene.annotations.add(annotation);
		}

	</script>
</body>
</html> -->



<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Potree Viewer</title>

    <link rel="stylesheet" type="text/css" href="../build/potree/potree.css">
    <link rel="stylesheet" type="text/css" href="../libs/jquery-ui/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="../libs/openlayers3/ol.css">
    <link rel="stylesheet" type="text/css" href="../libs/spectrum/spectrum.css">
    <link rel="stylesheet" type="text/css" href="../libs/jstree/themes/mixed/style.css">
</head>

<body>
    <script src="../libs/jquery/jquery-3.1.1.min.js"></script>
    <script src="../libs/spectrum/spectrum.js"></script>
    <script src="../libs/jquery-ui/jquery-ui.min.js"></script>
    <script src="../libs/other/BinaryHeap.js"></script>
    <script src="../libs/tween/tween.min.js"></script>
    <script src="../libs/d3/d3.js"></script>
    <script src="../libs/proj4/proj4.js"></script>
    <script src="../libs/openlayers3/ol.js"></script>
    <script src="../libs/i18next/i18next.js"></script>
    <script src="../libs/jstree/jstree.js"></script>
    <script src="../build/potree/potree.js"></script>
    <script src="../libs/plasio/js/laslaz.js"></script>

    <div class="potree_container" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px;">
        <div id="potree_render_area" style="background-image: url('../build/potree/resources/images/background.jpg');"></div>
        <div id="potree_sidebar_container"></div>
    </div>

    <<div id="buttonContainer" style="position: absolute; top: 20px; right: 20px; z-index: 1000;">
        <button id="backButton" onclick="window.history.back();" style="
        display: inline-block;
        margin-right: 10px;
        padding: 10px 20px;
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        " onmouseover="this.style.backgroundColor='#e53935';" onmouseout="this.style.backgroundColor='#f44336';">
            Back
        </button>

        <button id="logoutButton" onclick="handleLogoutButton();" style="
        display: inline-block;
        padding: 10px 20px;
        background-color: #f44336;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.3s;
        " onmouseover="this.style.backgroundColor='#e53935';" onmouseout="this.style.backgroundColor='#f44336';">
            Logout
        </button>
    </div>

	<!-- Regular Script for Global Functions -->
    <script>
        async function handleLogoutButton() {
            const token = new URLSearchParams(window.location.search).get('token');

            if (token) {
                try {
                    await fetch('http://localhost:5000/api/auth/logout', {
                        method: 'POST',
                        headers: {
                            'x-auth-token': token
                        }
                    });
                } catch (error) {
                    console.error('Error during logout:', error);
                }
            }

            // Clear token and navigate to login page
            localStorage.removeItem('token');
            window.location.href = 'http://localhost:3000/login';
			window.location.reload();
        }
    </script>

    <script type="module">

        import * as THREE from "../libs/three.js/build/three.module.js";

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const token = getQueryParam('token');

        if (token) {
            fetch('http://localhost:5000/api/auth/user', {
                method: 'GET',
                headers: {
                    'x-auth-token': token
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Authentication failed');
                }
                return response.json();
            })
            .then(data => {
                if (data) {
                    window.viewer = new Potree.Viewer(document.getElementById("potree_render_area"));

                    viewer.loadGUI().then(() => {
                        viewer.setLanguage('en');
                        $("#menu_tools").next().show();
                        viewer.toggleSidebar();
                    });

                    const lasFilename = getQueryParam('lasFilename');

                    if (lasFilename) {
                        // var url = lasFilename ? 'https://d2ugqt65ye2v1s.cloudfront.net/pointclouds/' + lasFilename + '/potree.json' : '';
                        const projectURL = `https://d2ugqt65ye2v1s.cloudfront.net/pointclouds/${lasFilename}/potree.json`;

                        viewer.loadProject(projectURL).then(() => {
                            console.log(`Project ${projectURL} loaded`);
                        }).catch(error => {
                            console.error('Error loading project:', error);
                        });
                    } else {
                        console.error('No lasFilename parameter found in the URL');
                    }

                } else {
                    window.location.href = 'http://localhost:3000/login';
                }
            })
            .catch(error => {
                console.error('Error during authentication:', error);
                window.location.href = 'http://localhost:3000/login';
            });
        } else {
            window.location.href = 'http://localhost:3000/login';
        }

    </script>
</body>

</html>
